<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="assets/styles/Styles.css">
    <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
</head>
<body>
<main class="myMane">
    <h1>Customer Management</h1>
    <form class="row g-3" id="myform">
        <div class="col-md-6">
            <label class="form-label">Customer ID</label>
            <input type="text" name="id" class="form-control" id="id">
        </div>
        <div class="col-md-6">
            <label class="form-label">Name</label>
            <input type="text" name="name" class="form-control" id="name">
        </div>
        <div class="col-12">
            <label class="form-label">Address</label>
            <input type="text" name="address" class="form-control" id="address" placeholder="1234 Main St">
        </div>
        <div class="col-12">
            <label class="form-label">Contact </label>
            <input type="tel" name="tel" class="form-control" id="tel" placeholder="+94 xxx xxxx">
        </div>
        <div class="col-12">
            <button type="button" class="btn btn-primary" id="saveBtn">Save</button>
            <button type="button" class="btn btn-primary bg-info border-info" id="updateBtn">Update</button>
            <button type="button" class="btn btn-primary bg-danger border-danger" id="deleteBtn">Delete</button>
        </div>
    </form>
    <br>
    <form class="d-flex" role="search">
        <input class="form-control me-2 was-validated " type="search" placeholder="Search" aria-label="Search"
               id="search">
        <button class="btn btn-outline-success" type="submit">Search</button>
    </form>
    <br>

    <form class="row g-3 p-2">
        <table class="table" id="tbl">
            <thead>
            <th>Customer ID</th>
            <th>Customer Name</th>
            <th>Customer Address</th>
            <th>Customer Contact</th>
            </thead>
            <tbody>
            </tbody>
        </table>
    </form>
</main>
<script src="../assets/lib/jquery-3.6.4.min.js"></script>
<script>

    const data = "DATA";
    var arrIndex = -1; // index of selected object

    //------------add new object into the localStorage---------------------------

    $('#saveBtn').on('click', () => {

        let arr= getLocalSData();

        isExistsById(arr) === true  ? alert("Customer ID all ready exists !") :
            arr.push(initObj()),localStorage.setItem(data, JSON.stringify(arr));
        loadData();
        addTableClickEvent();
        clearData();
    });

    //--------check customer_id all ready exists --------------------------

    function isExistsById(arr){
        let flag = false;
        arr.filter((event) => {
            if (event.customer_id === $('#id').val()){
                flag = true;
            }
        });
        return flag;
    }


    //----------------get localStorage array-------------------------------

    function getLocalSData(){

        let pre_data = localStorage.getItem(data);
        let data_array = [];
        if(pre_data){
            data_array = JSON.parse(pre_data);
        }
        return data_array;
    }

    //--------------create obj using textField data----------------------------

    function initObj(){
        return   {
            customer_id : $('#id').val(),
            customer_name :$('#name').val(),
            customer_address : $('#address').val(),
            customer_tel : $('#tel').val()
        }
    }

    //-------------------load table data-------------------------------

    function loadData(){

        let per_data = localStorage.getItem(data);

        $('table tbody tr td').remove();

        let  customer_data_arr = JSON.parse(per_data);
        customer_data_arr.map((value) => {
            var row = "<tr>" +
                "<td>"+ value.customer_id +"</td>" +
                "<td>"+ value.customer_name +"</td>" +
                "<td>"+ value.customer_address +"</td>" +
                "<td>"+ value.customer_tel +"</td>" +
                "</tr>";

            $('tbody').append(row);

            //---------------add table row with other way----------------------

            /*var tr=  document.createElement('tr');

            var td1 = tr.appendChild(document.createElement('td'));
            var td2 = tr.appendChild(document.createElement('td'));
            var td3 = tr.appendChild(document.createElement('td'));
            var td4 = tr.appendChild(document.createElement('td'));

            td1.innerHTML=value.customer_id;
            td2.innerHTML=value.customer_name;
            td3.innerHTML=value.customer_address;
            td4.innerHTML=value.customer_tel;

            document.getElementById("tbl").appendChild(tr);*/
        });
    }

    //---------------add table row click event listener-------------------------

    function addTableClickEvent() {

        $('table  tbody  tr').on('click', (event) => {
            $('#id').val(event.currentTarget.cells[0].innerText)
            $('#name').val(event.currentTarget.cells[1].innerText)
            $('#address').val(event.currentTarget.cells[2].innerText)
            $('#tel').val(event.currentTarget.cells[3].innerText)
            arrIndex = event.currentTarget.sectionRowIndex;

            document.getElementById('saveBtn').disabled = true;
            document.getElementById('id').disabled = true;
        });
    }

    loadData();
    addTableClickEvent();


    //-----------------update data in localStorage-------------------------------

    $('#updateBtn').on('click', () => {

        console.log(arrIndex)
        if (arrIndex < 0){
            alert("Please save the new customer before update !");
            return;
        }
        let cus_arr = getLocalSData();

        cus_arr[arrIndex] = initObj();
        localStorage.setItem(data, JSON.stringify(cus_arr));
        loadData();
        addTableClickEvent();
        clearData();
        arrIndex = -1;
    });

    //----------------------delete data in localStorage------------------------------

    $('#deleteBtn').on('click', () => {

        if (arrIndex < 0){
            alert("Please save the new customer before delete !");
            return;
        }
        let cus_arr = getLocalSData();

        cus_arr.splice(arrIndex, 1);
        localStorage.setItem(data, JSON.stringify(cus_arr));
        loadData();
        addTableClickEvent();
        clearData();
        arrIndex = -1;
    });
    //-----------------------clear function-----------------------------------

    function clearData(){
        $('#id').val("");
        $('#name').val("");
        $('#address').val("");
        $('#tel').val("");
        document.getElementById('id').disabled = false;
        document.getElementById('saveBtn').disabled = false;
    }
</script>
</body>
</html>